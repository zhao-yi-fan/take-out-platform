import{d as J,m as K,v as P,b as Q,e as p,f as z,r as m,o as L,c as B,a as d,w as C,i as N,h as c,t as S,F as W,k as X,j as Y,u as Z,s as I,x as M,y as oo,z as eo,A as to,p as so,l as no,_ as ao}from"./index-9be7e2e0.js";import{p as lo}from"./prompt-a0e596fd.js";import{u as io}from"./orderStore-bf09841e.js";import{u as co}from"./shopStore-2430f778.js";import{u as ro}from"./collectionStore-f8d4b771.js";const uo=g=>(so("data-v-d1553801"),g=g(),no(),g),mo={class:"top-Commodity"},vo={class:"top-Commodity-shop"},po=["src"],fo={class:"top-Commodity-shop-card"},ho=uo(()=>c("br",null,null,-1)),_o={class:"top-Commodity-shop-card-address"},yo={class:"top-Commodity-list"},Io=J({__name:"commodityDetail",setup(g){const U=co(),j=io(),r=K(),b=ro(),F=P(),w=Q(),A=p(1),_=p(0),O=z(()=>U.shopsList),s=p(null),l=z(()=>b.collectionList),k=p({}),v=p(""),x=p(0),y=p(!1),R=()=>{w.go(-1)},V=async()=>{if(!r.loginInfo)return I("您未登录");if(x.value=="0")return M("请选择商品");const t=s.value.commodity,o=[];t.forEach((u,f)=>{Array.isArray(u.children)&&u.children.length>0&&u.children.forEach((n,h)=>{n.num&&n.num>0&&o.push({foodId:u.classificationId+"_"+n.commodityId,foodNum:n.num,foodMoney:n.commodityMoney,foodName:n.commodityName,foodImageUrl:n.commodityImage})})});const e={shopsId:v.value,userId:r.loginInfo?r.loginInfo.userId:null,foodList:o,money:x.value/100},i=await j.setOrderInfo(e);oo({message:"订单提交中...",forbidClick:!0}),setTimeout(()=>{eo(),i.code?(to("挑选成功"),w.push({path:"/billDetail",query:{businessesId:i.businessesId}})):M("下单失败")},1e3)},q=t=>{const o=O.value.find(e=>e.shopsId===t);o&&(s.value=o,k.value=s.value.commodity)};v.value=F.query.shopsId,q(v.value),s.value.commodity.forEach((t,o)=>{t.children.forEach((e,i)=>{e.num=0})}),l.value.forEach((t,o)=>{r.loginInfo&&t.userId==r.loginInfo.userId&&t.shopsIds.forEach((e,i)=>{e==v.value&&(y.value=!0)})});const $=()=>{if(!r.loginInfo)return I("您未登录");if(y.value)l.value.forEach((t,o)=>{t.userId==r.loginInfo.userId&&t.shopsIds.forEach((e,i)=>{e==v.value&&(t.shopsIds.splice(i,1),y.value=!1,I("取消收藏"))})}),b.setCollectionList(l.value);else{let t=!1;for(let o=0;o<l.value.length;o++){const e=l.value[o];if(e.userId==r.loginInfo.userId)return t=!0,e.shopsIds.push(v.value),y.value=!0,b.setCollectionList(l.value),I("收藏成功")}if(!t){let o=l.value[l.value.length-1].collectionId;o++;const e=[];e.push(v.value),l.value.push({collectionId:o,userId:r.loginInfo.userId,shopsIds:e}),b.setCollectionList(l.value),I("收藏成功")}}},T=(t,o,e)=>{t=="delect"?o-1>=0&&(s.value.commodity[_.value].children[e].num=o-1):s.value.commodity[_.value].children[e].num=o+1;const i=s.value.commodity;let u=0;i.forEach((f,n)=>{Array.isArray(f.children)&&f.children.length>0&&f.children.forEach((h,D)=>{typeof h.num=="number"&&(u+=h.num*Number(h.commodityMoney))})}),x.value=u*100};return(t,o)=>{const e=m("van-icon"),i=m("van-nav-bar"),u=m("van-tag"),f=m("van-notice-bar"),n=m("van-button"),h=m("van-card"),D=m("van-tree-select"),G=m("van-submit-bar");return L(),B("div",mo,[d(i,{title:s.value.shopsName,"left-text":"返回","left-arrow":"",onClickLeft:R,onClickRight:$},{right:C(()=>[d(e,{name:y.value?"star":"star-o",size:"18"},null,8,["name"]),N(" 收藏 ")]),_:1},8,["title"]),c("div",vo,[c("img",{src:s.value.signImage,alt:""},null,8,po),c("div",fo,[c("p",null,S(s.value.shopsName),1),c("div",null,[N(" 评分："),c("span",null,S(s.value.score),1)]),d(u,{type:"danger"},{default:C(()=>[N("优质商家")]),_:1}),ho,c("span",_o,"地址："+S(s.value.address),1),d(f,{scrollable:"",text:s.value.notice},null,8,["text"])]),c("div",yo,[d(D,{"active-id":A.value,"onUpdate:activeId":o[0]||(o[0]=a=>A.value=a),"main-active-index":_.value,"onUpdate:mainActiveIndex":o[1]||(o[1]=a=>_.value=a),items:k.value},{content:C(()=>[(L(!0),B(W,null,X(k.value[_.value].children,(a,E)=>(L(),Y(h,{key:E,price:a.commodityMoney,desc:a.commodityDescribe,title:a.commodityName,thumb:a.commodityImage},{footer:C(()=>[d(n,{icon:"minus",type:"primary",size:"mini",round:"",plain:"",onClick:H=>T("delect",a.num,E)},null,8,["onClick"]),c("span",null,S(a.num),1),d(n,{icon:"plus",type:"primary",size:"mini",round:"",onClick:H=>T("add",a.num,E)},null,8,["onClick"])]),_:2},1032,["price","desc","title","thumb"]))),128))]),_:1},8,["active-id","main-active-index","items"])]),d(G,{price:x.value,"button-text":"提交订单",onSubmit:V},null,8,["price"])]),d(Z(lo))])}}});const ko=ao(Io,[["__scopeId","data-v-d1553801"]]);export{ko as default};
