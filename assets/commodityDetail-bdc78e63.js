import{defineComponent as j,ref as m,computed as p,resolveComponent as c,openBlock as h,createElementBlock as N,createVNode as r,withCtx as v,createTextVNode as I,createElementVNode as i,toDisplayString as _,Fragment as A,renderList as G,createBlock as H,unref as J}from"vue";import{showToast as K,showFailToast as T,showLoadingToast as P,closeToast as Q,showSuccessToast as W}from"vant";import{useRoute as X,useRouter as Y}from"vue-router";import{p as Z}from"./prompt-d349b1de.js";import{u as oo,_ as eo}from"./index-f7e6495e.js";import{u as to}from"./orderStore-658e61b4.js";import{u as no}from"./shopStore-c2808a23.js";import{u as so}from"./collectionStore-579b65e0.js";import"./vendor-24691ccf.js";const io={class:"top-commodity"},ro={class:"top-commodity-shop"},ao=["src"],co={class:"top-commodity-shop-card"},lo={class:"top-commodity-shop-card-address"},uo={class:"top-commodity-list"},mo=j({__name:"commodityDetail",setup(po){const w=no(),D=to(),b=oo(),g=so(),L=X(),C=Y(),S=m(1),u=m(0),M=p(()=>w.shopsList),a=p(()=>M.value.find(t=>t.shopsId===d.value)),l=m([]),d=m(Number(L.query.shopsId)),f=p(()=>l.value.reduce((t,o)=>t+o.children.reduce((n,e)=>n+(e.count||0)*+e.commodityMoney,0),0)*100),U=p(()=>g.isCollection(d.value));(()=>{a&&(l.value=(a.value.commodity||[]).map((t,o)=>({...t,children:t.children.map((n,e)=>({...n,count:0}))})))})();const z=()=>{C.go(-1)},B=async()=>{if(!b.loginInfo)return K("您未登录");if(f.value===0)return T("请选择商品");const t=D.setOrderInfo({shopsId:d.value,userId:b.loginInfo.userId,foodList:l.value.reduce((o,n)=>o.concat(n.children.filter(e=>e.count&&e.count>0).map(e=>({foodId:n.classificationId+"_"+e.commodityId,foodNum:e.count,foodMoney:e.commodityMoney,foodName:e.commodityName,foodImageUrl:e.commodityImage}))),[]),money:f.value/100});P({message:"订单提交中...",forbidClick:!0}),setTimeout(()=>{Q(),t.code?(W("挑选成功"),C.push({path:"/billDetail",query:{businessesId:t.businessesId}})):T("下单失败")},1e3)},O=()=>{g.addCollection({shopId:d.value})},x=(t,o,n)=>{t=="delect"?o>0&&(l.value[u.value].children[n].count=o-1):l.value[u.value].children[n].count=o+1};return(t,o)=>{const n=c("van-icon"),e=c("van-nav-bar"),R=c("van-tag"),V=c("van-notice-bar"),k=c("van-button"),q=c("van-card"),E=c("van-tree-select"),F=c("van-submit-bar");return h(),N("div",io,[r(e,{title:a.value.shopsName,"left-text":"返回","left-arrow":"",onClickLeft:z,onClickRight:O},{right:v(()=>[r(n,{name:U.value?"star":"star-o",size:"18"},null,8,["name"]),o[2]||(o[2]=I(" 收藏 ",-1))]),_:1},8,["title"]),i("div",ro,[i("img",{src:a.value.signImage,alt:""},null,8,ao),i("div",co,[i("p",null,_(a.value.shopsName),1),i("div",null,[o[3]||(o[3]=I(" 评分：",-1)),i("span",null,_(a.value.score),1)]),r(R,{type:"danger"},{default:v(()=>[...o[4]||(o[4]=[I("优质商家",-1)])]),_:1}),o[5]||(o[5]=i("br",null,null,-1)),i("span",lo,"地址："+_(a.value.address),1),r(V,{scrollable:"",text:a.value.notice},null,8,["text"])]),i("div",uo,[r(E,{"active-id":S.value,"onUpdate:activeId":o[0]||(o[0]=s=>S.value=s),"main-active-index":u.value,"onUpdate:mainActiveIndex":o[1]||(o[1]=s=>u.value=s),items:l.value},{content:v(()=>[(h(!0),N(A,null,G(l.value[u.value].children,(s,y)=>(h(),H(q,{key:y,price:s.commodityMoney,desc:s.commodityDescribe,title:s.commodityName,thumb:s.commodityImage},{footer:v(()=>[r(k,{icon:"minus",type:"primary",size:"mini",round:"",plain:"",onClick:$=>x("delect",s.count,y)},null,8,["onClick"]),i("span",null,_(s.count),1),r(k,{icon:"plus",type:"primary",size:"mini",round:"",onClick:$=>x("add",s.count,y)},null,8,["onClick"])]),_:2},1032,["price","desc","title","thumb"]))),128))]),_:1},8,["active-id","main-active-index","items"])]),r(F,{price:f.value,"button-text":"提交订单",onSubmit:B},null,8,["price"])]),r(J(Z))])}}});const xo=eo(mo,[["__scopeId","data-v-38414227"]]);export{xo as default};
