import{d as E,m as G,v as H,b as J,e as p,f as v,r,o as I,c as w,a as c,w as _,i as b,h as a,t as h,F as K,k as P,j as Q,u as W,s as X,x as T,y as Y,z as Z,A as oo,p as eo,l as to,_ as so}from"./index-60e0fd6e.js";import{p as no}from"./prompt-400d41c9.js";import{u as ao}from"./orderStore-20f5f1ee.js";import{u as co}from"./shopStore-0463a4aa.js";import{u as io}from"./collectionStore-f61fb057.js";const ro=d=>(eo("data-v-38414227"),d=d(),to(),d),lo={class:"top-commodity"},uo={class:"top-commodity-shop"},mo=["src"],po={class:"top-commodity-shop-card"},vo=ro(()=>a("br",null,null,-1)),_o={class:"top-commodity-shop-card-address"},ho={class:"top-commodity-list"},fo=E({__name:"commodityDetail",setup(d){const D=co(),L=ao(),g=G(),S=io(),z=H(),x=J(),C=p(1),u=p(0),B=v(()=>D.shopsList),i=v(()=>B.value.find(t=>t.shopsId===m.value)),l=p([]),m=p(Number(z.query.shopsId)),f=v(()=>l.value.reduce((t,e)=>t+e.children.reduce((s,o)=>s+(o.count||0)*+o.commodityMoney,0),0)*100),M=v(()=>S.isCollection(m.value));(()=>{i&&(l.value=(i.value.commodity||[]).map((t,e)=>({...t,children:t.children.map((s,o)=>({...s,count:0}))})))})();const U=()=>{x.go(-1)},F=async()=>{if(!g.loginInfo)return X("您未登录");if(f.value===0)return T("请选择商品");const t=L.setOrderInfo({shopsId:m.value,userId:g.loginInfo.userId,foodList:l.value.reduce((e,s)=>e.concat(s.children.filter(o=>o.count&&o.count>0).map(o=>({foodId:s.classificationId+"_"+o.commodityId,foodNum:o.count,foodMoney:o.commodityMoney,foodName:o.commodityName,foodImageUrl:o.commodityImage}))),[]),money:f.value/100});Y({message:"订单提交中...",forbidClick:!0}),setTimeout(()=>{Z(),t.code?(oo("挑选成功"),x.push({path:"/billDetail",query:{businessesId:t.businessesId}})):T("下单失败")},1e3)},O=()=>{S.addCollection({shopId:m.value})},k=(t,e,s)=>{t=="delect"?e>0&&(l.value[u.value].children[s].count=e-1):l.value[u.value].children[s].count=e+1};return(t,e)=>{const s=r("van-icon"),o=r("van-nav-bar"),R=r("van-tag"),V=r("van-notice-bar"),N=r("van-button"),j=r("van-card"),q=r("van-tree-select"),A=r("van-submit-bar");return I(),w("div",lo,[c(o,{title:i.value.shopsName,"left-text":"返回","left-arrow":"",onClickLeft:U,onClickRight:O},{right:_(()=>[c(s,{name:M.value?"star":"star-o",size:"18"},null,8,["name"]),b(" 收藏 ")]),_:1},8,["title"]),a("div",uo,[a("img",{src:i.value.signImage,alt:""},null,8,mo),a("div",po,[a("p",null,h(i.value.shopsName),1),a("div",null,[b(" 评分："),a("span",null,h(i.value.score),1)]),c(R,{type:"danger"},{default:_(()=>[b("优质商家")]),_:1}),vo,a("span",_o,"地址："+h(i.value.address),1),c(V,{scrollable:"",text:i.value.notice},null,8,["text"])]),a("div",ho,[c(q,{"active-id":C.value,"onUpdate:activeId":e[0]||(e[0]=n=>C.value=n),"main-active-index":u.value,"onUpdate:mainActiveIndex":e[1]||(e[1]=n=>u.value=n),items:l.value},{content:_(()=>[(I(!0),w(K,null,P(l.value[u.value].children,(n,y)=>(I(),Q(j,{key:y,price:n.commodityMoney,desc:n.commodityDescribe,title:n.commodityName,thumb:n.commodityImage},{footer:_(()=>[c(N,{icon:"minus",type:"primary",size:"mini",round:"",plain:"",onClick:$=>k("delect",n.count,y)},null,8,["onClick"]),a("span",null,h(n.count),1),c(N,{icon:"plus",type:"primary",size:"mini",round:"",onClick:$=>k("add",n.count,y)},null,8,["onClick"])]),_:2},1032,["price","desc","title","thumb"]))),128))]),_:1},8,["active-id","main-active-index","items"])]),c(A,{price:f.value,"button-text":"提交订单",onSubmit:F},null,8,["price"])]),c(W(no))])}}});const Co=so(fo,[["__scopeId","data-v-38414227"]]);export{Co as default};
