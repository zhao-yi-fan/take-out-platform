import{defineComponent as j,ref as m,computed as p,resolveComponent as r,openBlock as h,createElementBlock as N,createVNode as a,withCtx as v,createTextVNode as I,createElementVNode as i,toDisplayString as _,Fragment as A,renderList as G,createBlock as H,unref as J}from"vue";import{showToast as K,showFailToast as T,showLoadingToast as P,closeToast as Q,showSuccessToast as W}from"vant";import{useRoute as X,useRouter as Y}from"vue-router";import{p as Z}from"./prompt-a92e7cba.js";import{u as oo,_ as eo}from"./index-e65c4456.js";import{u as to}from"./orderStore-371bc8dc.js";import{u as no}from"./shopStore-cab4c829.js";import{u as so}from"./collectionStore-f3817bb2.js";const io={class:"top-commodity"},ao={class:"top-commodity-shop"},co=["src"],ro={class:"top-commodity-shop-card"},lo={class:"top-commodity-shop-card-address"},uo={class:"top-commodity-list"},mo=j({__name:"commodityDetail",setup(po){const w=no(),D=to(),b=oo(),g=so(),L=X(),C=Y(),S=m(1),u=m(0),M=p(()=>w.shopsList),c=p(()=>M.value.find(t=>t.shopsId===d.value)),l=m([]),d=m(Number(L.query.shopsId)),f=p(()=>l.value.reduce((t,o)=>t+o.children.reduce((n,e)=>n+(e.count||0)*+e.commodityMoney,0),0)*100),U=p(()=>g.isCollection(d.value));(()=>{c&&(l.value=(c.value.commodity||[]).map((t,o)=>({...t,children:t.children.map((n,e)=>({...n,count:0}))})))})();const z=()=>{C.go(-1)},B=async()=>{if(!b.loginInfo)return K("您未登录");if(f.value===0)return T("请选择商品");const t=D.setOrderInfo({shopsId:d.value,userId:b.loginInfo.userId,foodList:l.value.reduce((o,n)=>o.concat(n.children.filter(e=>e.count&&e.count>0).map(e=>({foodId:n.classificationId+"_"+e.commodityId,foodNum:e.count,foodMoney:e.commodityMoney,foodName:e.commodityName,foodImageUrl:e.commodityImage}))),[]),money:f.value/100});P({message:"订单提交中...",forbidClick:!0}),setTimeout(()=>{Q(),t.code?(W("挑选成功"),C.push({path:"/billDetail",query:{businessesId:t.businessesId}})):T("下单失败")},1e3)},O=()=>{g.addCollection({shopId:d.value})},x=(t,o,n)=>{t=="delect"?o>0&&(l.value[u.value].children[n].count=o-1):l.value[u.value].children[n].count=o+1};return(t,o)=>{const n=r("van-icon"),e=r("van-nav-bar"),R=r("van-tag"),V=r("van-notice-bar"),k=r("van-button"),q=r("van-card"),E=r("van-tree-select"),F=r("van-submit-bar");return h(),N("div",io,[a(e,{title:c.value.shopsName,"left-text":"返回","left-arrow":"",onClickLeft:z,onClickRight:O},{right:v(()=>[a(n,{name:U.value?"star":"star-o",size:"18"},null,8,["name"]),o[2]||(o[2]=I(" 收藏 ",-1))]),_:1},8,["title"]),i("div",ao,[i("img",{src:c.value.signImage,alt:""},null,8,co),i("div",ro,[i("p",null,_(c.value.shopsName),1),i("div",null,[o[3]||(o[3]=I(" 评分：",-1)),i("span",null,_(c.value.score),1)]),a(R,{type:"danger"},{default:v(()=>[...o[4]||(o[4]=[I("优质商家",-1)])]),_:1}),o[5]||(o[5]=i("br",null,null,-1)),i("span",lo,"地址："+_(c.value.address),1),a(V,{scrollable:"",text:c.value.notice},null,8,["text"])]),i("div",uo,[a(E,{"active-id":S.value,"onUpdate:activeId":o[0]||(o[0]=s=>S.value=s),"main-active-index":u.value,"onUpdate:mainActiveIndex":o[1]||(o[1]=s=>u.value=s),items:l.value},{content:v(()=>[(h(!0),N(A,null,G(l.value[u.value].children,(s,y)=>(h(),H(q,{key:y,price:s.commodityMoney,desc:s.commodityDescribe,title:s.commodityName,thumb:s.commodityImage},{footer:v(()=>[a(k,{icon:"minus",type:"primary",size:"mini",round:"",plain:"",onClick:$=>x("delect",s.count,y)},null,8,["onClick"]),i("span",null,_(s.count),1),a(k,{icon:"plus",type:"primary",size:"mini",round:"",onClick:$=>x("add",s.count,y)},null,8,["onClick"])]),_:2},1032,["price","desc","title","thumb"]))),128))]),_:1},8,["active-id","main-active-index","items"])]),a(F,{price:f.value,"button-text":"提交订单",onSubmit:B},null,8,["price"])]),a(J(Z))])}}});const So=eo(mo,[["__scopeId","data-v-38414227"]]);export{So as default};
