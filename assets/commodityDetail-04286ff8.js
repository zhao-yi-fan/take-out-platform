import{d as H,m as J,v as K,b as P,e as v,f as M,r as p,o as E,c as U,a as u,w as S,i as L,h as d,t as C,F as Q,k as W,j as X,u as Y,s as I,x as z,y as Z,z as oo,A as eo,p as to,l as so,_ as no}from"./index-e29b0745.js";import{p as ao}from"./prompt-15f214e3.js";import{u as co}from"./orderStore-e76d76f1.js";import{u as io}from"./shopStore-fdf5285b.js";import{u as lo}from"./collectionStore-22edfbc8.js";const ro=g=>(to("data-v-5bd8428c"),g=g(),so(),g),uo={class:"top-commodity"},mo={class:"top-commodity-shop"},po=["src"],vo={class:"top-commodity-shop-card"},fo=ro(()=>d("br",null,null,-1)),ho={class:"top-commodity-shop-card-address"},_o={class:"top-commodity-list"},yo=H({__name:"commodityDetail",setup(g){const B=io(),F=co(),m=J(),b=lo(),O=K(),w=P(),A=v(1),_=v(0),R=M(()=>B.shopsList),c=v(null),r=M(()=>b.collectionList),N=v({}),f=v(+O.query.shopsId),x=v(0),y=v(!1),V=()=>{w.go(-1)},j=async()=>{var n;if(!m.loginInfo)return I("您未登录");if(x.value=="0")return z("请选择商品");const a=c.value.commodity,s=[];a.forEach((e,i)=>{Array.isArray(e.children)&&e.children.length>0&&e.children.forEach((o,h)=>{o.num&&o.num>0&&s.push({foodId:e.classificationId+"_"+o.commodityId,foodNum:o.num,foodMoney:o.commodityMoney,foodName:o.commodityName,foodImageUrl:o.commodityImage})})});const t=await F.setOrderInfo({shopsId:f.value,userId:((n=m.loginInfo)==null?void 0:n.userId)||null,foodList:c.value.commodity.reduce((e,i)=>e.concat(i.children.filter(o=>o.num&&o.num>0).map(o=>({foodId:i.classificationId+"_"+o.commodityId,foodNum:o.num,foodMoney:o.commodityMoney,foodName:o.commodityName,foodImageUrl:o.commodityImage}))),[]),money:x.value/100});Z({message:"订单提交中...",forbidClick:!0}),setTimeout(()=>{oo(),t.code?(eo("挑选成功"),w.push({path:"/billDetail",query:{businessesId:t.businessesId}})):z("下单失败")},1e3)};(()=>{const a=R.value.find(s=>s.shopsId===f.value);a&&(c.value=a,N.value=c.value.commodity)})(),c.value.commodity.forEach((a,s)=>{a.children.forEach((t,n)=>{t.num=0})}),m.loginInfo&&r.value.forEach((a,s)=>{var t;a.userId==((t=m.loginInfo)==null?void 0:t.userId)&&a.shopsIds.forEach((n,e)=>{n==f.value&&(y.value=!0)})});const q=()=>{var a,s;if(!m.loginInfo)return I("您未登录");if(y.value)r.value.forEach((t,n)=>{var e;t.userId==((e=m.loginInfo)==null?void 0:e.userId)&&t.shopsIds.forEach((i,o)=>{i==f.value&&(t.shopsIds.splice(o,1),y.value=!1,I("取消收藏"))})}),b.setCollectionList(r.value);else{let t=!1;for(let n=0;n<r.value.length;n++){const e=r.value[n];if(e.userId==((a=m.loginInfo)==null?void 0:a.userId))return t=!0,e.shopsIds.push(f.value),y.value=!0,b.setCollectionList(r.value),I("收藏成功")}if(!t){let n=r.value[r.value.length-1].collectionId;n++;const e=[];e.push(f.value),r.value.push({collectionId:n,userId:(s=m.loginInfo)==null?void 0:s.userId,shopsIds:e}),b.setCollectionList(r.value),I("收藏成功")}}},T=(a,s,t)=>{a=="delect"?s-1>=0&&(c.value.commodity[_.value].children[t].num=s-1):c.value.commodity[_.value].children[t].num=s+1;const n=c.value.commodity;let e=0;n.forEach((i,o)=>{Array.isArray(i.children)&&i.children.length>0&&i.children.forEach((h,D)=>{typeof h.num=="number"&&(e+=h.num*Number(h.commodityMoney))})}),x.value=e*100};return(a,s)=>{const t=p("van-icon"),n=p("van-nav-bar"),e=p("van-tag"),i=p("van-notice-bar"),o=p("van-button"),h=p("van-card"),D=p("van-tree-select"),$=p("van-submit-bar");return E(),U("div",uo,[u(n,{title:c.value.shopsName,"left-text":"返回","left-arrow":"",onClickLeft:V,onClickRight:q},{right:S(()=>[u(t,{name:y.value?"star":"star-o",size:"18"},null,8,["name"]),L(" 收藏 ")]),_:1},8,["title"]),d("div",mo,[d("img",{src:c.value.signImage,alt:""},null,8,po),d("div",vo,[d("p",null,C(c.value.shopsName),1),d("div",null,[L(" 评分："),d("span",null,C(c.value.score),1)]),u(e,{type:"danger"},{default:S(()=>[L("优质商家")]),_:1}),fo,d("span",ho,"地址："+C(c.value.address),1),u(i,{scrollable:"",text:c.value.notice},null,8,["text"])]),d("div",_o,[u(D,{"active-id":A.value,"onUpdate:activeId":s[0]||(s[0]=l=>A.value=l),"main-active-index":_.value,"onUpdate:mainActiveIndex":s[1]||(s[1]=l=>_.value=l),items:N.value},{content:S(()=>[(E(!0),U(Q,null,W(N.value[_.value].children,(l,k)=>(E(),X(h,{key:k,price:l.commodityMoney,desc:l.commodityDescribe,title:l.commodityName,thumb:l.commodityImage},{footer:S(()=>[u(o,{icon:"minus",type:"primary",size:"mini",round:"",plain:"",onClick:G=>T("delect",l.num,k)},null,8,["onClick"]),d("span",null,C(l.num),1),u(o,{icon:"plus",type:"primary",size:"mini",round:"",onClick:G=>T("add",l.num,k)},null,8,["onClick"])]),_:2},1032,["price","desc","title","thumb"]))),128))]),_:1},8,["active-id","main-active-index","items"])]),u($,{price:x.value,"button-text":"提交订单",onSubmit:j},null,8,["price"])]),u(Y(ao))])}}});const No=no(yo,[["__scopeId","data-v-5bd8428c"]]);export{No as default};
