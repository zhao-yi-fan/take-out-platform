import{showToast as A,showFailToast as N,showLoadingToast as E,closeToast as G,showSuccessToast as H}from"vant";import{useRoute as J,useRouter as K}from"vue-router";import{p as P}from"./prompt-d5b92409.js";import{d as Q,k as W,b as m,e as p,r,o as h,c as w,a as i,w as v,h as I,g as a,t as _,F as X,j as Y,i as Z,u as oo,_ as eo}from"./index-7a5bb6f9.js";import{u as to}from"./orderStore-69f1a9a9.js";import{u as no}from"./shopStore-14156849.js";import{u as so}from"./collectionStore-56855432.js";const ao={class:"top-commodity"},io={class:"top-commodity-shop"},co=["src"],ro={class:"top-commodity-shop-card"},lo={class:"top-commodity-shop-card-address"},uo={class:"top-commodity-list"},mo=Q({__name:"commodityDetail",setup(po){const T=no(),D=to(),b=W(),g=so(),L=J(),C=K(),S=m(1),u=m(0),B=p(()=>T.shopsList),c=p(()=>B.value.find(t=>t.shopsId===d.value)),l=m([]),d=m(Number(L.query.shopsId)),f=p(()=>l.value.reduce((t,o)=>t+o.children.reduce((n,e)=>n+(e.count||0)*+e.commodityMoney,0),0)*100),M=p(()=>g.isCollection(d.value));(()=>{c&&(l.value=(c.value.commodity||[]).map((t,o)=>({...t,children:t.children.map((n,e)=>({...n,count:0}))})))})();const U=()=>{C.go(-1)},z=async()=>{if(!b.loginInfo)return A("您未登录");if(f.value===0)return N("请选择商品");const t=D.setOrderInfo({shopsId:d.value,userId:b.loginInfo.userId,foodList:l.value.reduce((o,n)=>o.concat(n.children.filter(e=>e.count&&e.count>0).map(e=>({foodId:n.classificationId+"_"+e.commodityId,foodNum:e.count,foodMoney:e.commodityMoney,foodName:e.commodityName,foodImageUrl:e.commodityImage}))),[]),money:f.value/100});E({message:"订单提交中...",forbidClick:!0}),setTimeout(()=>{G(),t.code?(H("挑选成功"),C.push({path:"/billDetail",query:{businessesId:t.businessesId}})):N("下单失败")},1e3)},F=()=>{g.addCollection({shopId:d.value})},x=(t,o,n)=>{t=="delect"?o>0&&(l.value[u.value].children[n].count=o-1):l.value[u.value].children[n].count=o+1};return(t,o)=>{const n=r("van-icon"),e=r("van-nav-bar"),O=r("van-tag"),R=r("van-notice-bar"),k=r("van-button"),V=r("van-card"),j=r("van-tree-select"),q=r("van-submit-bar");return h(),w("div",ao,[i(e,{title:c.value.shopsName,"left-text":"返回","left-arrow":"",onClickLeft:U,onClickRight:F},{right:v(()=>[i(n,{name:M.value?"star":"star-o",size:"18"},null,8,["name"]),o[2]||(o[2]=I(" 收藏 ",-1))]),_:1},8,["title"]),a("div",io,[a("img",{src:c.value.signImage,alt:""},null,8,co),a("div",ro,[a("p",null,_(c.value.shopsName),1),a("div",null,[o[3]||(o[3]=I(" 评分：",-1)),a("span",null,_(c.value.score),1)]),i(O,{type:"danger"},{default:v(()=>[...o[4]||(o[4]=[I("优质商家",-1)])]),_:1}),o[5]||(o[5]=a("br",null,null,-1)),a("span",lo,"地址："+_(c.value.address),1),i(R,{scrollable:"",text:c.value.notice},null,8,["text"])]),a("div",uo,[i(j,{"active-id":S.value,"onUpdate:activeId":o[0]||(o[0]=s=>S.value=s),"main-active-index":u.value,"onUpdate:mainActiveIndex":o[1]||(o[1]=s=>u.value=s),items:l.value},{content:v(()=>[(h(!0),w(X,null,Y(l.value[u.value].children,(s,y)=>(h(),Z(V,{key:y,price:s.commodityMoney,desc:s.commodityDescribe,title:s.commodityName,thumb:s.commodityImage},{footer:v(()=>[i(k,{icon:"minus",type:"primary",size:"mini",round:"",plain:"",onClick:$=>x("delect",s.count,y)},null,8,["onClick"]),a("span",null,_(s.count),1),i(k,{icon:"plus",type:"primary",size:"mini",round:"",onClick:$=>x("add",s.count,y)},null,8,["onClick"])]),_:2},1032,["price","desc","title","thumb"]))),128))]),_:1},8,["active-id","main-active-index","items"])]),i(q,{price:f.value,"button-text":"提交订单",onSubmit:z},null,8,["price"])]),i(oo(P))])}}});const Co=eo(mo,[["__scopeId","data-v-38414227"]]);export{Co as default};
