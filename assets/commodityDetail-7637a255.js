import{d as G,m as H,v as J,b as K,e as p,f as g,r,o as S,c as z,a as i,w as y,u as l,i as x,h as a,t as b,F as P,k as Q,j as W,s as X,x as A,y as Y,z as Z,A as oo,p as eo,l as to,_ as no}from"./index-fe9f4ec6.js";import{p as so}from"./prompt-1e6c75ee.js";import{u as ao}from"./orderStore-68a2b4be.js";import{u as co}from"./shopStore-b3c1909d.js";import{u as io}from"./collectionStore-acd9413e.js";const ro=_=>(eo("data-v-1775d6b4"),_=_(),to(),_),lo={class:"top-commodity"},uo={class:"top-commodity-shop"},mo=["src"],po={class:"top-commodity-shop-card"},_o=ro(()=>a("br",null,null,-1)),vo={class:"top-commodity-shop-card-address"},ho={class:"top-commodity-list"},fo=G({__name:"commodityDetail",setup(_){const B=co(),M=ao(),C=H(),k=io(),U=J(),N=K(),w=p(1),u=p(0),E=g(()=>B.shopsList),e=g(()=>E.value.find(s=>s.shopsId===h.value)),v=p([]),h=p(Number(U.query.shopsId)),f=p(0),F=g(()=>k.isCollection(h.value));(()=>{e&&(v.value=(e.value.commodity||[]).map((s,t)=>({...s,children:s.children.map((c,o)=>({...c,count:0}))})))})();const O=()=>{N.go(-1)},R=async()=>{if(!C.loginInfo)return X("您未登录");if(f.value===0)return A("请选择商品");const s=M.setOrderInfo({shopsId:h.value,userId:C.loginInfo.userId,foodList:v.value.reduce((t,c)=>t.concat(c.children.filter(o=>o.count&&o.count>0).map(o=>({foodId:c.classificationId+"_"+o.commodityId,foodNum:o.count,foodMoney:o.commodityMoney,foodName:o.commodityName,foodImageUrl:o.commodityImage}))),[]),money:f.value/100});Y({message:"订单提交中...",forbidClick:!0}),setTimeout(()=>{Z(),s.code?(oo("挑选成功"),N.push({path:"/billDetail",query:{businessesId:s.businessesId}})):A("下单失败")},1e3)},V=()=>{k.addCollection({shopId:h.value})},T=(s,t,c)=>{s=="delect"?t-1>=0&&(e.value.commodity[u.value].children[c].count=t-1):e.value.commodity[u.value].children[c].count=t+1;let o=0;e.value.commodity.forEach((m,D)=>{Array.isArray(m.children)&&m.children.length>0&&m.children.forEach((d,L)=>{typeof d.count=="number"&&(o+=d.count*Number(d.commodityMoney))})}),f.value=o*100};return(s,t)=>{const c=r("van-icon"),o=r("van-nav-bar"),m=r("van-tag"),D=r("van-notice-bar"),d=r("van-button"),L=r("van-card"),j=r("van-tree-select"),q=r("van-submit-bar");return S(),z("div",lo,[i(o,{title:l(e).shopsName,"left-text":"返回","left-arrow":"",onClickLeft:O,onClickRight:V},{right:y(()=>[i(c,{name:l(F)?"star":"star-o",size:"18"},null,8,["name"]),x(" 收藏 ")]),_:1},8,["title"]),a("div",uo,[a("img",{src:l(e).signImage,alt:""},null,8,mo),a("div",po,[a("p",null,b(l(e).shopsName),1),a("div",null,[x(" 评分："),a("span",null,b(l(e).score),1)]),i(m,{type:"danger"},{default:y(()=>[x("优质商家")]),_:1}),_o,a("span",vo,"地址："+b(l(e).address),1),i(D,{scrollable:"",text:l(e).notice},null,8,["text"])]),a("div",ho,[i(j,{"active-id":w.value,"onUpdate:activeId":t[0]||(t[0]=n=>w.value=n),"main-active-index":u.value,"onUpdate:mainActiveIndex":t[1]||(t[1]=n=>u.value=n),items:v.value},{content:y(()=>[(S(!0),z(P,null,Q(v.value[u.value].children,(n,I)=>(S(),W(L,{key:I,price:n.commodityMoney,desc:n.commodityDescribe,title:n.commodityName,thumb:n.commodityImage},{footer:y(()=>[i(d,{icon:"minus",type:"primary",size:"mini",round:"",plain:"",onClick:$=>T("delect",n.count,I)},null,8,["onClick"]),a("span",null,b(n.count),1),i(d,{icon:"plus",type:"primary",size:"mini",round:"",onClick:$=>T("add",n.count,I)},null,8,["onClick"])]),_:2},1032,["price","desc","title","thumb"]))),128))]),_:1},8,["active-id","main-active-index","items"])]),i(q,{price:f.value,"button-text":"提交订单",onSubmit:R},null,8,["price"])]),i(l(so))])}}});const Co=no(fo,[["__scopeId","data-v-1775d6b4"]]);export{Co as default};
