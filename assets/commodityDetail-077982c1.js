import{_ as K,m as P,v as Q,b as W,e as I,f as N,n as X,r as m,o as w,c as R,a as d,w as S,u as v,h as c,t as k,i as A,s as g,x as U,y as Y,z as Z,A as oo,F as eo,k as to,j as so,p as no,l as ao}from"./index-fa9abe46.js";import{p as io}from"./prompt-d30c296a.js";import{u as lo}from"./orderStore-4641dd5f.js";import{u as co}from"./shopStore-f090ca7a.js";import{u as ro}from"./collectionStore-fae6ae8f.js";const uo=b=>(no("data-v-8d76be56"),b=b(),ao(),b),mo={class:"top-Commodity"},po={class:"top-Commodity-shop"},vo=["src"],fo={class:"top-Commodity-shop-card"},ho=uo(()=>c("br",null,null,-1)),_o={class:"top-Commodity-shop-card-address"},yo={class:"top-Commodity-list"},Io={__name:"commodityDetail",setup(b){const T=co(),j=lo(),r=P(),x=ro(),F=Q(),D=W(),z=I(1),_=I(0),O=N(()=>T.shopsList),s=N(()=>T.currentShopInfo),i=N(()=>x.collectionList),E=X(null),p=I(""),C=I(0),y=I(!1),V=()=>{D.go(-1)},q=async()=>{if(!r.loginInfo)return g("您未登录");if(C.value=="0")return U("请选择商品");let t=s.value.commodity,o=[];t.forEach((u,f)=>{Array.isArray(u.children)&&u.children.length>0&&u.children.forEach((n,h)=>{n.num&&n.num>0&&o.push({foodId:u.classificationId+"_"+n.commodityId,foodNum:n.num,foodMoney:n.commodityMoney,foodName:n.commodityName,foodImageUrl:n.commodityImage})})});var e={shopsId:p.value,userId:r.loginInfo?r.loginInfo.userId:null,foodList:o,money:C.value/100};let l=await j.setOrderInfo(e);Y({message:"订单提交中...",forbidClick:!0}),setTimeout(()=>{Z(),l.code?(oo("挑选成功"),D.push({path:"/billDetail",query:{businessesId:l.businessesId}})):U("下单失败")},1e3)},$=t=>{let o=O.value.find(e=>e.shopsId===t);o&&(s.value=o,E=s.value.commodity)};p.value=F.query.shopsId,$(p.value),s.value.commodity.forEach((t,o)=>{t.children.forEach((e,l)=>{e.num=0})}),i.value.forEach((t,o)=>{r.loginInfo&&t.userId==r.loginInfo.userId&&t.shopsIds.forEach((e,l)=>{e==p.value&&(y.value=!0)})});const G=()=>{if(!r.loginInfo)return g("您未登录");if(y.value)i.value.forEach((t,o)=>{t.userId==r.loginInfo.userId&&t.shopsIds.forEach((e,l)=>{e==p.value&&(t.shopsIds.splice(l,1),y.value=!1,g("取消收藏"))})}),x.setCollectionList(i.value);else{let t=!1;for(let o=0;o<i.value.length;o++){let e=i.value[o];if(e.userId==r.loginInfo.userId)return t=!0,e.shopsIds.push(p.value),y.value=!0,x.setCollectionList(i.value),g("收藏成功")}if(!t){let o=i.value[i.value.length-1].collectionId;o++;let e=[];e.push(p.value),i.value.push({collectionId:o,userId:r.loginInfo.userId,shopsIds:e}),x.setCollectionList(i.value),g("收藏成功")}}},B=(t,o,e)=>{t=="delect"?o-1>=0&&(s.value.commodity[_.value].children[e].num=o-1):s.value.commodity[_.value].children[e].num=o+1;let l=s.value.commodity,u=0;l.forEach((f,n)=>{Array.isArray(f.children)&&f.children.length>0&&f.children.forEach((h,M)=>{typeof h.num=="number"&&(u+=h.num*Number(h.commodityMoney))})}),C.value=u*100};return(t,o)=>{const e=m("van-icon"),l=m("van-nav-bar"),u=m("van-tag"),f=m("van-notice-bar"),n=m("van-button"),h=m("van-card"),M=m("van-tree-select"),H=m("van-submit-bar");return w(),R("div",mo,[d(l,{title:v(s).shopsName,"left-text":"返回","left-arrow":"",onClickLeft:V,onClickRight:G},{right:S(()=>[d(e,{name:y.value?"star":"star-o",size:"18"},null,8,["name"]),A(" 收藏 ")]),_:1},8,["title"]),c("div",po,[c("img",{src:v(s).signImage,alt:""},null,8,vo),c("div",fo,[c("p",null,k(v(s).shopsName),1),c("div",null,[A(" 评分："),c("span",null,k(v(s).score),1)]),d(u,{type:"danger"},{default:S(()=>[A("优质商家")]),_:1}),ho,c("span",_o,"地址："+k(v(s).address),1),d(f,{scrollable:"",text:v(s).notice},null,8,["text"])]),c("div",yo,[d(M,{"active-id":z.value,"onUpdate:activeId":o[0]||(o[0]=a=>z.value=a),"main-active-index":_.value,"onUpdate:mainActiveIndex":o[1]||(o[1]=a=>_.value=a),items:E},{content:S(()=>[(w(!0),R(eo,null,to(E[_.value].children,(a,L)=>(w(),so(h,{key:L,price:a.commodityMoney,desc:a.commodityDescribe,title:a.commodityName,thumb:a.commodityImage},{footer:S(()=>[d(n,{icon:"minus",type:"primary",size:"mini",round:"",plain:"",onClick:J=>B("delect",a.num,L)},null,8,["onClick"]),c("span",null,k(a.num),1),d(n,{icon:"plus",type:"primary",size:"mini",round:"",onClick:J=>B("add",a.num,L)},null,8,["onClick"])]),_:2},1032,["price","desc","title","thumb"]))),128))]),_:1},8,["active-id","main-active-index","items"])]),d(H,{price:C.value,"button-text":"提交订单",onSubmit:q},null,8,["price"])]),d(v(io))])}}},ko=K(Io,[["__scopeId","data-v-8d76be56"]]);export{ko as default};
