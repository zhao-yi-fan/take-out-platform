import{_ as T,b as x,n as O,u as R,d as A,f as E,t as B,r as p,o as w,c as N,a as u,w as v,h as d,i as y,l as k,T as a,F as j,k as M,j as z,p as U,m as V}from"./index-09841709.js";import{p as q}from"./prompt-c4d3da11.js";const D={name:"",components:{"wsw-prompt":q},setup(n,{root:f}){const c=x(),h=O(),g=R(),o=A({activeId:1,activeIndex:0,shopsList:E(()=>c.state.shopsList),collectionList:E(()=>c.state.collectionList),currentShopInfo:null,items:null,shopsId:"",price:0,collectionStatus:!1}),S=()=>{g.go(-1)},b=async()=>{if(!c.state.loginInfo)return a("您未登录");if(o.price=="0")return console.log(o.price),a.fail("请选择商品");let s=o.currentShopInfo.commodity,e=[];s.forEach((i,m)=>{Array.isArray(i.children)&&i.children.length>0&&i.children.forEach((l,_)=>{l.num&&l.num>0&&e.push({foodId:i.classificationId+"_"+l.commodityId,foodNum:l.num,foodMoney:l.commodityMoney,foodName:l.commodityName,foodImageUrl:l.commodityImage})})});var t={shopsId:o.shopsId,userId:c.state.loginInfo?c.state.loginInfo.userId:null,foodList:e,money:o.price/100};console.log(o.currentShopInfo),console.log(t,"obj====");let r=await c.dispatch("setOrderInfo",t);a.loading({message:"订单提交中...",forbidClick:!0}),setTimeout(()=>{a.clear(),r.code?(a.success("挑选成功"),g.push({path:"/Bill",query:{businessesId:r.businessesId}}),console.log(c.state.orderList)):a.fail("下单失败")},1e3)},L=s=>{for(let e=0;e<o.shopsList.length;e++){let t=o.shopsList[e];s===t.shopsId&&(o.currentShopInfo=t,o.items=o.currentShopInfo.commodity,console.log(o.items),console.log(o,"a"))}};o.shopsId=h.query.shopsId,L(o.shopsId),console.log(o.currentShopInfo),o.currentShopInfo.commodity.forEach((s,e)=>{s.children.forEach((t,r)=>{t.num=0})}),o.collectionList.forEach((s,e)=>{c.state.loginInfo&&s.userId==c.state.loginInfo.userId&&s.shopsIds.forEach((t,r)=>{t==o.shopsId&&(console.log(t),o.collectionStatus=!0)})});const C=()=>{if(!c.state.loginInfo)return a("您未登录");if(o.collectionStatus)o.collectionList.forEach((s,e)=>{s.userId==c.state.loginInfo.userId&&s.shopsIds.forEach((t,r)=>{t==o.shopsId&&(console.log(t),s.shopsIds.splice(r,1),o.collectionStatus=!1,a("取消收藏"))})}),c.commit("SET_COLLECTION_LIST",o.collectionList);else{let s=!1;for(let e=0;e<o.collectionList.length;e++){let t=o.collectionList[e];if(t.userId==c.state.loginInfo.userId)return s=!0,t.shopsIds.push(o.shopsId),o.collectionStatus=!0,c.commit("SET_COLLECTION_LIST",o.collectionList),a("收藏成功")}if(!s){let e=o.collectionList[o.collectionList.length-1].collectionId;e++;let t=[];t.push(o.shopsId),o.collectionList.push({collectionId:e,userId:c.state.loginInfo.userId,shopsIds:t}),c.commit("SET_COLLECTION_LIST",o.collectionList),a("收藏成功")}}},I=(s,e,t)=>{s=="delect"?e-1>=0&&(o.currentShopInfo.commodity[o.activeIndex].children[t].num=e-1):o.currentShopInfo.commodity[o.activeIndex].children[t].num=e+1;let r=o.currentShopInfo.commodity,i=0;r.forEach((m,l)=>{Array.isArray(m.children)&&m.children.length>0&&m.children.forEach((_,X)=>{typeof _.num=="number"&&(i+=_.num*Number(_.commodityMoney))})}),o.price=i*100};return{...B(o),onClickLeft:S,onClickRight:C,onSubmit:b,addShop:I}}},F=n=>(U("data-v-022406ab"),n=n(),V(),n),$={class:"wsw-top-Commodity"},G={class:"wsw-top-Commodity-shop"},H=["src"],J={class:"wsw-top-Commodity-shop-card"},K=F(()=>d("br",null,null,-1)),P={class:"wsw-top-Commodity-shop-card-address"},Q={class:"wsw-top-Commodity-list"};function W(n,f,c,h,g,o){const S=p("van-icon"),b=p("van-nav-bar"),L=p("van-tag"),C=p("van-notice-bar"),I=p("van-button"),s=p("van-card"),e=p("van-tree-select"),t=p("van-submit-bar"),r=p("wsw-prompt");return w(),N("div",$,[u(b,{title:n.currentShopInfo.shopsName,"left-text":"返回","left-arrow":"",onClickLeft:h.onClickLeft,onClickRight:h.onClickRight},{right:v(()=>[u(S,{name:n.collectionStatus?"star":"star-o",size:"18"},null,8,["name"]),k(" 收藏 ")]),_:1},8,["title","onClickLeft","onClickRight"]),d("div",G,[d("img",{src:n.currentShopInfo.signImage,alt:""},null,8,H),d("div",J,[d("p",null,y(n.currentShopInfo.shopsName),1),d("div",null,[k(" 评分："),d("span",null,y(n.currentShopInfo.score),1)]),u(L,{type:"danger"},{default:v(()=>[k("优质商家")]),_:1}),K,d("span",P,"地址："+y(n.currentShopInfo.address),1),u(C,{scrollable:"",text:n.currentShopInfo.notice},null,8,["text"])]),d("div",Q,[u(e,{"active-id":n.activeId,"onUpdate:activeId":f[0]||(f[0]=i=>n.activeId=i),"main-active-index":n.activeIndex,"onUpdate:mainActiveIndex":f[1]||(f[1]=i=>n.activeIndex=i),items:n.items},{content:v(()=>[(w(!0),N(j,null,M(n.items[n.activeIndex].children,(i,m)=>(w(),z(s,{key:m,price:i.commodityMoney,desc:i.commodityDescribe,title:i.commodityName,thumb:i.commodityImage},{footer:v(()=>[u(I,{icon:"minus",type:"primary",size:"mini",round:"",plain:"",onClick:l=>h.addShop("delect",i.num,m)},null,8,["onClick"]),d("span",null,y(i.num),1),u(I,{icon:"plus",type:"primary",size:"mini",round:"",onClick:l=>h.addShop("add",i.num,m)},null,8,["onClick"])]),_:2},1032,["price","desc","title","thumb"]))),128))]),_:1},8,["active-id","main-active-index","items"])]),u(t,{price:n.price,"button-text":"提交订单",onSubmit:h.onSubmit},null,8,["price","onSubmit"])]),u(r)])}const oo=T(D,[["render",W],["__scopeId","data-v-022406ab"]]);export{oo as default};
