import{defineComponent as j,ref as m,computed as p,resolveComponent as r,openBlock as h,createElementBlock as N,createVNode as i,withCtx as v,createTextVNode as I,createElementVNode as a,toDisplayString as _,Fragment as A,renderList as G,createBlock as H,unref as J}from"vue";import{a as K,b as P,u as Q,_ as W}from"./index-391e1562.js";import{p as X}from"./prompt-30ffad94.js";import{u as Y}from"./orderStore-7401eaea.js";import{u as Z}from"./shopStore-d43f461f.js";import{u as oo}from"./collectionStore-36c08155.js";import{s as eo,f as T,g as to,h as no,i as so}from"./vendor-27337327.js";const ao={class:"top-commodity"},io={class:"top-commodity-shop"},co=["src"],ro={class:"top-commodity-shop-card"},lo={class:"top-commodity-shop-card-address"},uo={class:"top-commodity-list"},mo=j({__name:"commodityDetail",setup(po){const w=Z(),D=Y(),b=K(),g=oo(),L=P(),C=Q(),S=m(1),u=m(0),M=p(()=>w.shopsList),c=p(()=>M.value.find(t=>t.shopsId===d.value)),l=m([]),d=m(Number(L.query.shopsId)),f=p(()=>l.value.reduce((t,o)=>t+o.children.reduce((n,e)=>n+(e.count||0)*+e.commodityMoney,0),0)*100),U=p(()=>g.isCollection(d.value));(()=>{c&&(l.value=(c.value.commodity||[]).map((t,o)=>({...t,children:t.children.map((n,e)=>({...n,count:0}))})))})();const z=()=>{C.go(-1)},B=async()=>{if(!b.loginInfo)return eo("您未登录");if(f.value===0)return T("请选择商品");const t=D.setOrderInfo({shopsId:d.value,userId:b.loginInfo.userId,foodList:l.value.reduce((o,n)=>o.concat(n.children.filter(e=>e.count&&e.count>0).map(e=>({foodId:n.classificationId+"_"+e.commodityId,foodNum:e.count,foodMoney:e.commodityMoney,foodName:e.commodityName,foodImageUrl:e.commodityImage}))),[]),money:f.value/100});to({message:"订单提交中...",forbidClick:!0}),setTimeout(()=>{no(),t.code?(so("挑选成功"),C.push({path:"/billDetail",query:{businessesId:t.businessesId}})):T("下单失败")},1e3)},O=()=>{g.addCollection({shopId:d.value})},x=(t,o,n)=>{t=="delect"?o>0&&(l.value[u.value].children[n].count=o-1):l.value[u.value].children[n].count=o+1};return(t,o)=>{const n=r("van-icon"),e=r("van-nav-bar"),R=r("van-tag"),V=r("van-notice-bar"),k=r("van-button"),q=r("van-card"),E=r("van-tree-select"),F=r("van-submit-bar");return h(),N("div",ao,[i(e,{title:c.value.shopsName,"left-text":"返回","left-arrow":"",onClickLeft:z,onClickRight:O},{right:v(()=>[i(n,{name:U.value?"star":"star-o",size:"18"},null,8,["name"]),o[2]||(o[2]=I(" 收藏 ",-1))]),_:1},8,["title"]),a("div",io,[a("img",{src:c.value.signImage,alt:""},null,8,co),a("div",ro,[a("p",null,_(c.value.shopsName),1),a("div",null,[o[3]||(o[3]=I(" 评分：",-1)),a("span",null,_(c.value.score),1)]),i(R,{type:"danger"},{default:v(()=>[...o[4]||(o[4]=[I("优质商家",-1)])]),_:1}),o[5]||(o[5]=a("br",null,null,-1)),a("span",lo,"地址："+_(c.value.address),1),i(V,{scrollable:"",text:c.value.notice},null,8,["text"])]),a("div",uo,[i(E,{"active-id":S.value,"onUpdate:activeId":o[0]||(o[0]=s=>S.value=s),"main-active-index":u.value,"onUpdate:mainActiveIndex":o[1]||(o[1]=s=>u.value=s),items:l.value},{content:v(()=>[(h(!0),N(A,null,G(l.value[u.value].children,(s,y)=>(h(),H(q,{key:y,price:s.commodityMoney,desc:s.commodityDescribe,title:s.commodityName,thumb:s.commodityImage},{footer:v(()=>[i(k,{icon:"minus",type:"primary",size:"mini",round:"",plain:"",onClick:$=>x("delect",s.count,y)},null,8,["onClick"]),a("span",null,_(s.count),1),i(k,{icon:"plus",type:"primary",size:"mini",round:"",onClick:$=>x("add",s.count,y)},null,8,["onClick"])]),_:2},1032,["price","desc","title","thumb"]))),128))]),_:1},8,["active-id","main-active-index","items"])]),i(F,{price:f.value,"button-text":"提交订单",onSubmit:B},null,8,["price"])]),i(J(X))])}}});const Co=W(mo,[["__scopeId","data-v-38414227"]]);export{Co as default};
