import{d as A,l as E,p as G,b as H,e as m,f as p,r,o as h,c as N,a as c,w as v,i as I,h as a,t as _,F as J,k as K,j as P,u as Q,s as W,q as w,v as X,x as Y,y as Z,_ as oo}from"./index-520b68e5.js";import{p as eo}from"./prompt-7d8eeaf8.js";import{u as to}from"./orderStore-efe5aa87.js";import{u as no}from"./shopStore-9dd97cf3.js";import{u as so}from"./collectionStore-a8cc7111.js";const ao={class:"top-commodity"},co={class:"top-commodity-shop"},io=["src"],ro={class:"top-commodity-shop-card"},lo={class:"top-commodity-shop-card-address"},uo={class:"top-commodity-list"},mo=A({__name:"commodityDetail",setup(po){const T=no(),D=to(),b=E(),g=so(),L=G(),x=H(),C=m(1),u=m(0),B=p(()=>T.shopsList),i=p(()=>B.value.find(t=>t.shopsId===d.value)),l=m([]),d=m(Number(L.query.shopsId)),f=p(()=>l.value.reduce((t,o)=>t+o.children.reduce((n,e)=>n+(e.count||0)*+e.commodityMoney,0),0)*100),M=p(()=>g.isCollection(d.value));(()=>{i&&(l.value=(i.value.commodity||[]).map((t,o)=>({...t,children:t.children.map((n,e)=>({...n,count:0}))})))})();const U=()=>{x.go(-1)},q=async()=>{if(!b.loginInfo)return W("您未登录");if(f.value===0)return w("请选择商品");const t=D.setOrderInfo({shopsId:d.value,userId:b.loginInfo.userId,foodList:l.value.reduce((o,n)=>o.concat(n.children.filter(e=>e.count&&e.count>0).map(e=>({foodId:n.classificationId+"_"+e.commodityId,foodNum:e.count,foodMoney:e.commodityMoney,foodName:e.commodityName,foodImageUrl:e.commodityImage}))),[]),money:f.value/100});X({message:"订单提交中...",forbidClick:!0}),setTimeout(()=>{Y(),t.code?(Z("挑选成功"),x.push({path:"/billDetail",query:{businessesId:t.businessesId}})):w("下单失败")},1e3)},z=()=>{g.addCollection({shopId:d.value})},S=(t,o,n)=>{t=="delect"?o>0&&(l.value[u.value].children[n].count=o-1):l.value[u.value].children[n].count=o+1};return(t,o)=>{const n=r("van-icon"),e=r("van-nav-bar"),F=r("van-tag"),O=r("van-notice-bar"),k=r("van-button"),R=r("van-card"),V=r("van-tree-select"),j=r("van-submit-bar");return h(),N("div",ao,[c(e,{title:i.value.shopsName,"left-text":"返回","left-arrow":"",onClickLeft:U,onClickRight:z},{right:v(()=>[c(n,{name:M.value?"star":"star-o",size:"18"},null,8,["name"]),o[2]||(o[2]=I(" 收藏 ",-1))]),_:1},8,["title"]),a("div",co,[a("img",{src:i.value.signImage,alt:""},null,8,io),a("div",ro,[a("p",null,_(i.value.shopsName),1),a("div",null,[o[3]||(o[3]=I(" 评分：",-1)),a("span",null,_(i.value.score),1)]),c(F,{type:"danger"},{default:v(()=>[...o[4]||(o[4]=[I("优质商家",-1)])]),_:1}),o[5]||(o[5]=a("br",null,null,-1)),a("span",lo,"地址："+_(i.value.address),1),c(O,{scrollable:"",text:i.value.notice},null,8,["text"])]),a("div",uo,[c(V,{"active-id":C.value,"onUpdate:activeId":o[0]||(o[0]=s=>C.value=s),"main-active-index":u.value,"onUpdate:mainActiveIndex":o[1]||(o[1]=s=>u.value=s),items:l.value},{content:v(()=>[(h(!0),N(J,null,K(l.value[u.value].children,(s,y)=>(h(),P(R,{key:y,price:s.commodityMoney,desc:s.commodityDescribe,title:s.commodityName,thumb:s.commodityImage},{footer:v(()=>[c(k,{icon:"minus",type:"primary",size:"mini",round:"",plain:"",onClick:$=>S("delect",s.count,y)},null,8,["onClick"]),a("span",null,_(s.count),1),c(k,{icon:"plus",type:"primary",size:"mini",round:"",onClick:$=>S("add",s.count,y)},null,8,["onClick"])]),_:2},1032,["price","desc","title","thumb"]))),128))]),_:1},8,["active-id","main-active-index","items"])]),c(j,{price:f.value,"button-text":"提交订单",onSubmit:q},null,8,["price"])]),c(Q(eo))])}}});const bo=oo(mo,[["__scopeId","data-v-38414227"]]);export{bo as default};
