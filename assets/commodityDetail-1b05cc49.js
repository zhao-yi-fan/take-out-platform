import{d as H,m as J,v as K,b as P,e as d,f as z,r as l,o as S,c as A,a,w as h,u as B,i as x,h as s,t as y,F as Q,k as W,j as X,s as Y,x as M,y as Z,z as oo,A as eo,p as to,l as no,_ as so}from"./index-02b2b924.js";import{p as ao}from"./prompt-5dced830.js";import{u as co}from"./orderStore-699dc156.js";import{u as io}from"./shopStore-ef6d7344.js";import{u as lo}from"./collectionStore-a648d7be.js";const ro=v=>(to("data-v-f033f833"),v=v(),no(),v),uo={class:"top-commodity"},mo={class:"top-commodity-shop"},po=["src"],vo={class:"top-commodity-shop-card"},_o=ro(()=>s("br",null,null,-1)),fo={class:"top-commodity-shop-card-address"},ho={class:"top-commodity-list"},yo=H({__name:"commodityDetail",setup(v){const U=io(),E=co(),C=J(),k=lo(),F=K(),N=P(),w=d(1),u=d(0),O=z(()=>U.shopsList),t=d(null),I=d({}),_=d(Number(F.query.shopsId)),f=d(0),R=z(()=>k.isCollection(_.value)),V=()=>{N.go(-1)},j=async()=>{var o;if(!C.loginInfo)return Y("您未登录");if(f.value===0)return M("请选择商品");const c=await E.setOrderInfo({shopsId:_.value,userId:((o=C.loginInfo)==null?void 0:o.userId)||null,foodList:t.value.commodity.reduce((r,i)=>r.concat(i.children.filter(e=>e.num&&e.num>0).map(e=>({foodId:i.classificationId+"_"+e.commodityId,foodNum:e.num,foodMoney:e.commodityMoney,foodName:e.commodityName,foodImageUrl:e.commodityImage}))),[]),money:f.value/100});Z({message:"订单提交中...",forbidClick:!0}),setTimeout(()=>{oo(),c.code?(eo("挑选成功"),N.push({path:"/billDetail",query:{businessesId:c.businessesId}})):M("下单失败")},1e3)};(()=>{const c=O.value.find(o=>o.shopsId===_.value);c&&(t.value=c,I.value=(t.value.commodity||[]).map((o,r)=>({...o,children:o.children.map((i,e)=>({...i,num:0}))})))})();const q=()=>{k.addCollection({shopId:_.value})},T=(c,o,r)=>{c=="delect"?o-1>=0&&(t.value.commodity[u.value].children[r].num=o-1):t.value.commodity[u.value].children[r].num=o+1;const i=t.value.commodity;let e=0;i.forEach((m,b)=>{Array.isArray(m.children)&&m.children.length>0&&m.children.forEach((p,D)=>{typeof p.num=="number"&&(e+=p.num*Number(p.commodityMoney))})}),f.value=e*100};return(c,o)=>{var L;const r=l("van-icon"),i=l("van-nav-bar"),e=l("van-tag"),m=l("van-notice-bar"),b=l("van-button"),p=l("van-card"),D=l("van-tree-select"),$=l("van-submit-bar");return S(),A("div",uo,[a(i,{title:(L=t.value)==null?void 0:L.shopsName,"left-text":"返回","left-arrow":"",onClickLeft:V,onClickRight:q},{right:h(()=>[a(r,{name:B(R)?"star":"star-o",size:"18"},null,8,["name"]),x(" 收藏 ")]),_:1},8,["title"]),s("div",mo,[s("img",{src:t.value.signImage,alt:""},null,8,po),s("div",vo,[s("p",null,y(t.value.shopsName),1),s("div",null,[x(" 评分："),s("span",null,y(t.value.score),1)]),a(e,{type:"danger"},{default:h(()=>[x("优质商家")]),_:1}),_o,s("span",fo,"地址："+y(t.value.address),1),a(m,{scrollable:"",text:t.value.notice},null,8,["text"])]),s("div",ho,[a(D,{"active-id":w.value,"onUpdate:activeId":o[0]||(o[0]=n=>w.value=n),"main-active-index":u.value,"onUpdate:mainActiveIndex":o[1]||(o[1]=n=>u.value=n),items:I.value},{content:h(()=>[(S(!0),A(Q,null,W(I.value[u.value].children,(n,g)=>(S(),X(p,{key:g,price:n.commodityMoney,desc:n.commodityDescribe,title:n.commodityName,thumb:n.commodityImage},{footer:h(()=>[a(b,{icon:"minus",type:"primary",size:"mini",round:"",plain:"",onClick:G=>T("delect",n.num,g)},null,8,["onClick"]),s("span",null,y(n.num),1),a(b,{icon:"plus",type:"primary",size:"mini",round:"",onClick:G=>T("add",n.num,g)},null,8,["onClick"])]),_:2},1032,["price","desc","title","thumb"]))),128))]),_:1},8,["active-id","main-active-index","items"])]),a($,{price:f.value,"button-text":"提交订单",onSubmit:j},null,8,["price"])]),a(B(ao))])}}});const ko=so(yo,[["__scopeId","data-v-f033f833"]]);export{ko as default};
