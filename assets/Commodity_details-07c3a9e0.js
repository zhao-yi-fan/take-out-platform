import{_ as B,m as j,v as z,u as M,n as U,e as A,x as F,r as l,o as x,c as R,a,w as g,g as r,t as S,i as N,s as h,y as T,z as O,A as V,B as q,F as D,k as $,j as G,p as H,l as J}from"./index-53572ee4.js";import{p as K}from"./prompt-b5b7da67.js";import{u as P}from"./orderStore-2cedff09.js";import{u as Q}from"./shopStore-a09da9d7.js";import{u as W}from"./collectionStore-4d728efc.js";const X={name:"",components:{prompt:K},setup(n,{root:m}){const w=Q(),d=P(),i=j(),f=W(),b=z(),I=M(),o=U({activeId:1,activeIndex:0,shopsList:A(()=>w.shopsList),collectionList:A(()=>f.collectionList),currentShopInfo:null,items:null,shopsId:"",price:0,collectionStatus:!1}),L=()=>{I.go(-1)},_=async()=>{if(!i.loginInfo)return h("您未登录");if(o.price=="0")return console.log(o.price),T("请选择商品");let s=o.currentShopInfo.commodity,e=[];s.forEach((u,v)=>{Array.isArray(u.children)&&u.children.length>0&&u.children.forEach((p,y)=>{p.num&&p.num>0&&e.push({foodId:u.classificationId+"_"+p.commodityId,foodNum:p.num,foodMoney:p.commodityMoney,foodName:p.commodityName,foodImageUrl:p.commodityImage})})});var t={shopsId:o.shopsId,userId:i.loginInfo?i.loginInfo.userId:null,foodList:e,money:o.price/100};console.log(o.currentShopInfo),console.log(t,"obj====");let c=await d.setOrderInfo(t);O({message:"订单提交中...",forbidClick:!0}),setTimeout(()=>{V(),c.code?(q("挑选成功"),I.push({path:"/Bill",query:{businessesId:c.businessesId}}),console.log(d.orderList)):T("下单失败")},1e3)},C=s=>{for(let e=0;e<o.shopsList.length;e++){let t=o.shopsList[e];s===t.shopsId&&(o.currentShopInfo=t,o.items=o.currentShopInfo.commodity,console.log(o.items),console.log(o,"a"))}};o.shopsId=b.query.shopsId,C(o.shopsId),console.log(o.currentShopInfo),o.currentShopInfo.commodity.forEach((s,e)=>{s.children.forEach((t,c)=>{t.num=0})}),o.collectionList.forEach((s,e)=>{i.loginInfo&&s.userId==i.loginInfo.userId&&s.shopsIds.forEach((t,c)=>{t==o.shopsId&&(console.log(t),o.collectionStatus=!0)})});const k=()=>{if(!i.loginInfo)return h("您未登录");if(o.collectionStatus)o.collectionList.forEach((s,e)=>{s.userId==i.loginInfo.userId&&s.shopsIds.forEach((t,c)=>{t==o.shopsId&&(console.log(t),s.shopsIds.splice(c,1),o.collectionStatus=!1,h("取消收藏"))})}),f.setCollectionList(o.collectionList);else{let s=!1;for(let e=0;e<o.collectionList.length;e++){let t=o.collectionList[e];if(t.userId==i.loginInfo.userId)return s=!0,t.shopsIds.push(o.shopsId),o.collectionStatus=!0,f.setCollectionList(o.collectionList),h("收藏成功")}if(!s){let e=o.collectionList[o.collectionList.length-1].collectionId;e++;let t=[];t.push(o.shopsId),o.collectionList.push({collectionId:e,userId:i.loginInfo.userId,shopsIds:t}),f.setCollectionList(o.collectionList),h("收藏成功")}}},E=(s,e,t)=>{s=="delect"?e-1>=0&&(o.currentShopInfo.commodity[o.activeIndex].children[t].num=e-1):o.currentShopInfo.commodity[o.activeIndex].children[t].num=e+1;let c=o.currentShopInfo.commodity,u=0;c.forEach((v,p)=>{Array.isArray(v.children)&&v.children.length>0&&v.children.forEach((y,ro)=>{typeof y.num=="number"&&(u+=y.num*Number(y.commodityMoney))})}),o.price=u*100};return{...F(o),onClickLeft:L,onClickRight:k,onSubmit:_,addShop:E}}},Y=n=>(H("data-v-f889fb86"),n=n(),J(),n),Z={class:"top-Commodity"},oo={class:"top-Commodity-shop"},eo=["src"],to={class:"top-Commodity-shop-card"},no=Y(()=>r("br",null,null,-1)),so={class:"top-Commodity-shop-card-address"},io={class:"top-Commodity-list"};function co(n,m,w,d,i,f){const b=l("van-icon"),I=l("van-nav-bar"),o=l("van-tag"),L=l("van-notice-bar"),_=l("van-button"),C=l("van-card"),k=l("van-tree-select"),E=l("van-submit-bar"),s=l("prompt");return x(),R("div",Z,[a(I,{title:n.currentShopInfo.shopsName,"left-text":"返回","left-arrow":"",onClickLeft:d.onClickLeft,onClickRight:d.onClickRight},{right:g(()=>[a(b,{name:n.collectionStatus?"star":"star-o",size:"18"},null,8,["name"]),N(" 收藏 ")]),_:1},8,["title","onClickLeft","onClickRight"]),r("div",oo,[r("img",{src:n.currentShopInfo.signImage,alt:""},null,8,eo),r("div",to,[r("p",null,S(n.currentShopInfo.shopsName),1),r("div",null,[N(" 评分："),r("span",null,S(n.currentShopInfo.score),1)]),a(o,{type:"danger"},{default:g(()=>[N("优质商家")]),_:1}),no,r("span",so,"地址："+S(n.currentShopInfo.address),1),a(L,{scrollable:"",text:n.currentShopInfo.notice},null,8,["text"])]),r("div",io,[a(k,{"active-id":n.activeId,"onUpdate:activeId":m[0]||(m[0]=e=>n.activeId=e),"main-active-index":n.activeIndex,"onUpdate:mainActiveIndex":m[1]||(m[1]=e=>n.activeIndex=e),items:n.items},{content:g(()=>[(x(!0),R(D,null,$(n.items[n.activeIndex].children,(e,t)=>(x(),G(C,{key:t,price:e.commodityMoney,desc:e.commodityDescribe,title:e.commodityName,thumb:e.commodityImage},{footer:g(()=>[a(_,{icon:"minus",type:"primary",size:"mini",round:"",plain:"",onClick:c=>d.addShop("delect",e.num,t)},null,8,["onClick"]),r("span",null,S(e.num),1),a(_,{icon:"plus",type:"primary",size:"mini",round:"",onClick:c=>d.addShop("add",e.num,t)},null,8,["onClick"])]),_:2},1032,["price","desc","title","thumb"]))),128))]),_:1},8,["active-id","main-active-index","items"])]),a(E,{price:n.price,"button-text":"提交订单",onSubmit:d.onSubmit},null,8,["price","onSubmit"])]),a(s)])}const fo=B(X,[["render",co],["__scopeId","data-v-f889fb86"]]);export{fo as default};
