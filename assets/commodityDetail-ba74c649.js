import{p as D}from"./prompt-336bfa5a.js";import{u as B,_ as L}from"./index-84aac008.js";import{u as R}from"./orderStore-31f301f2.js";import{u as M}from"./shopStore-5e5560f7.js";import{u as U}from"./collectionStore-5ed64b74.js";import"./vendor-7ce8fbae.js";const z={class:"top-commodity"},F={class:"top-commodity-shop"},O=["src"],q={class:"top-commodity-shop-card"},$={class:"top-commodity-shop-card-address"},j={class:"top-commodity-list"},A=Vue.defineComponent({__name:"commodityDetail",setup(G){const f=M(),y=R(),d=B(),m=U(),h=VueRouter.useRoute(),p=VueRouter.useRouter(),v=Vue.ref(1),r=Vue.ref(0),N=Vue.computed(()=>f.shopsList),u=Vue.computed(()=>N.value.find(t=>t.shopsId===c.value)),a=Vue.ref([]),c=Vue.ref(Number(h.query.shopsId)),l=Vue.computed(()=>a.value.reduce((t,e)=>t+e.children.reduce((n,o)=>n+(o.count||0)*+o.commodityMoney,0),0)*100),I=Vue.computed(()=>m.isCollection(c.value));(()=>{u&&(a.value=(u.value.commodity||[]).map((t,e)=>({...t,children:t.children.map((n,o)=>({...n,count:0}))})))})();const C=()=>{p.go(-1)},b=async()=>{if(!d.loginInfo)return vant.showToast("您未登录");if(l.value===0)return vant.showFailToast("请选择商品");const t=y.setOrderInfo({shopsId:c.value,userId:d.loginInfo.userId,foodList:a.value.reduce((e,n)=>e.concat(n.children.filter(o=>o.count&&o.count>0).map(o=>({foodId:n.classificationId+"_"+o.commodityId,foodNum:o.count,foodMoney:o.commodityMoney,foodName:o.commodityName,foodImageUrl:o.commodityImage}))),[]),money:l.value/100});vant.showLoadingToast({message:"订单提交中...",forbidClick:!0}),setTimeout(()=>{vant.closeToast(),t.code?(vant.showSuccessToast("挑选成功"),p.push({path:"/billDetail",query:{businessesId:t.businessesId}})):vant.showFailToast("下单失败")},1e3)},g=()=>{m.addCollection({shopId:c.value})},V=(t,e,n)=>{t=="delect"?e>0&&(a.value[r.value].children[n].count=e-1):a.value[r.value].children[n].count=e+1};return(t,e)=>{const n=Vue.resolveComponent("van-icon"),o=Vue.resolveComponent("van-nav-bar"),x=Vue.resolveComponent("van-tag"),S=Vue.resolveComponent("van-notice-bar"),_=Vue.resolveComponent("van-button"),k=Vue.resolveComponent("van-card"),E=Vue.resolveComponent("van-tree-select"),w=Vue.resolveComponent("van-submit-bar");return Vue.openBlock(),Vue.createElementBlock("div",z,[Vue.createVNode(o,{title:u.value.shopsName,"left-text":"返回","left-arrow":"",onClickLeft:C,onClickRight:g},{right:Vue.withCtx(()=>[Vue.createVNode(n,{name:I.value?"star":"star-o",size:"18"},null,8,["name"]),e[2]||(e[2]=Vue.createTextVNode(" 收藏 ",-1))]),_:1},8,["title"]),Vue.createElementVNode("div",F,[Vue.createElementVNode("img",{src:u.value.signImage,alt:""},null,8,O),Vue.createElementVNode("div",q,[Vue.createElementVNode("p",null,Vue.toDisplayString(u.value.shopsName),1),Vue.createElementVNode("div",null,[e[3]||(e[3]=Vue.createTextVNode(" 评分：",-1)),Vue.createElementVNode("span",null,Vue.toDisplayString(u.value.score),1)]),Vue.createVNode(x,{type:"danger"},{default:Vue.withCtx(()=>[...e[4]||(e[4]=[Vue.createTextVNode("优质商家",-1)])]),_:1}),e[5]||(e[5]=Vue.createElementVNode("br",null,null,-1)),Vue.createElementVNode("span",$,"地址："+Vue.toDisplayString(u.value.address),1),Vue.createVNode(S,{scrollable:"",text:u.value.notice},null,8,["text"])]),Vue.createElementVNode("div",j,[Vue.createVNode(E,{"active-id":v.value,"onUpdate:activeId":e[0]||(e[0]=s=>v.value=s),"main-active-index":r.value,"onUpdate:mainActiveIndex":e[1]||(e[1]=s=>r.value=s),items:a.value},{content:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(a.value[r.value].children,(s,i)=>(Vue.openBlock(),Vue.createBlock(k,{key:i,price:s.commodityMoney,desc:s.commodityDescribe,title:s.commodityName,thumb:s.commodityImage},{footer:Vue.withCtx(()=>[Vue.createVNode(_,{icon:"minus",type:"primary",size:"mini",round:"",plain:"",onClick:T=>V("delect",s.count,i)},null,8,["onClick"]),Vue.createElementVNode("span",null,Vue.toDisplayString(s.count),1),Vue.createVNode(_,{icon:"plus",type:"primary",size:"mini",round:"",onClick:T=>V("add",s.count,i)},null,8,["onClick"])]),_:2},1032,["price","desc","title","thumb"]))),128))]),_:1},8,["active-id","main-active-index","items"])]),Vue.createVNode(w,{price:l.value,"button-text":"提交订单",onSubmit:b},null,8,["price"])]),Vue.createVNode(Vue.unref(D))])}}});const Y=L(A,[["__scopeId","data-v-38414227"]]);export{Y as default};
