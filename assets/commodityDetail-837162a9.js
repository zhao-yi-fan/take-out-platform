import{_ as J,m as K,v as P,b as Q,e as p,f as z,r as m,o as L,c as B,a as d,w as C,h as c,t as S,i as N,u as W,s as I,x as M,y as X,z as Y,A as Z,F as oo,k as eo,j as to,p as so,l as no}from"./index-4804f13d.js";import{p as ao}from"./prompt-8a387d8f.js";import{u as io}from"./orderStore-b4e6b025.js";import{u as lo}from"./shopStore-bf32f99a.js";import{u as co}from"./collectionStore-f124661d.js";const ro=g=>(so("data-v-fae89447"),g=g(),no(),g),uo={class:"top-Commodity"},mo={class:"top-Commodity-shop"},vo=["src"],po={class:"top-Commodity-shop-card"},fo=ro(()=>c("br",null,null,-1)),ho={class:"top-Commodity-shop-card-address"},_o={class:"top-Commodity-list"},yo={__name:"commodityDetail",setup(g){const R=lo(),U=io(),r=K(),b=co(),j=P(),w=Q(),A=p(1),_=p(0),F=z(()=>R.shopsList),s=p(null),i=z(()=>b.collectionList),k=p({}),v=p(""),x=p(0),y=p(!1),O=()=>{w.go(-1)},V=async()=>{if(!r.loginInfo)return I("您未登录");if(x.value=="0")return M("请选择商品");const t=s.value.commodity,o=[];t.forEach((u,f)=>{Array.isArray(u.children)&&u.children.length>0&&u.children.forEach((n,h)=>{n.num&&n.num>0&&o.push({foodId:u.classificationId+"_"+n.commodityId,foodNum:n.num,foodMoney:n.commodityMoney,foodName:n.commodityName,foodImageUrl:n.commodityImage})})});const e={shopsId:v.value,userId:r.loginInfo?r.loginInfo.userId:null,foodList:o,money:x.value/100},l=await U.setOrderInfo(e);X({message:"订单提交中...",forbidClick:!0}),setTimeout(()=>{Y(),l.code?(Z("挑选成功"),w.push({path:"/billDetail",query:{businessesId:l.businessesId}})):M("下单失败")},1e3)},q=t=>{const o=F.value.find(e=>e.shopsId===t);o&&(s.value=o,k.value=s.value.commodity)};v.value=j.query.shopsId,q(v.value),s.value.commodity.forEach((t,o)=>{t.children.forEach((e,l)=>{e.num=0})}),i.value.forEach((t,o)=>{r.loginInfo&&t.userId==r.loginInfo.userId&&t.shopsIds.forEach((e,l)=>{e==v.value&&(y.value=!0)})});const $=()=>{if(!r.loginInfo)return I("您未登录");if(y.value)i.value.forEach((t,o)=>{t.userId==r.loginInfo.userId&&t.shopsIds.forEach((e,l)=>{e==v.value&&(t.shopsIds.splice(l,1),y.value=!1,I("取消收藏"))})}),b.setCollectionList(i.value);else{let t=!1;for(let o=0;o<i.value.length;o++){const e=i.value[o];if(e.userId==r.loginInfo.userId)return t=!0,e.shopsIds.push(v.value),y.value=!0,b.setCollectionList(i.value),I("收藏成功")}if(!t){let o=i.value[i.value.length-1].collectionId;o++;const e=[];e.push(v.value),i.value.push({collectionId:o,userId:r.loginInfo.userId,shopsIds:e}),b.setCollectionList(i.value),I("收藏成功")}}},T=(t,o,e)=>{t=="delect"?o-1>=0&&(s.value.commodity[_.value].children[e].num=o-1):s.value.commodity[_.value].children[e].num=o+1;const l=s.value.commodity;let u=0;l.forEach((f,n)=>{Array.isArray(f.children)&&f.children.length>0&&f.children.forEach((h,D)=>{typeof h.num=="number"&&(u+=h.num*Number(h.commodityMoney))})}),x.value=u*100};return(t,o)=>{const e=m("van-icon"),l=m("van-nav-bar"),u=m("van-tag"),f=m("van-notice-bar"),n=m("van-button"),h=m("van-card"),D=m("van-tree-select"),G=m("van-submit-bar");return L(),B("div",uo,[d(l,{title:s.value.shopsName,"left-text":"返回","left-arrow":"",onClickLeft:O,onClickRight:$},{right:C(()=>[d(e,{name:y.value?"star":"star-o",size:"18"},null,8,["name"]),N(" 收藏 ")]),_:1},8,["title"]),c("div",mo,[c("img",{src:s.value.signImage,alt:""},null,8,vo),c("div",po,[c("p",null,S(s.value.shopsName),1),c("div",null,[N(" 评分："),c("span",null,S(s.value.score),1)]),d(u,{type:"danger"},{default:C(()=>[N("优质商家")]),_:1}),fo,c("span",ho,"地址："+S(s.value.address),1),d(f,{scrollable:"",text:s.value.notice},null,8,["text"])]),c("div",_o,[d(D,{"active-id":A.value,"onUpdate:activeId":o[0]||(o[0]=a=>A.value=a),"main-active-index":_.value,"onUpdate:mainActiveIndex":o[1]||(o[1]=a=>_.value=a),items:k.value},{content:C(()=>[(L(!0),B(oo,null,eo(k.value[_.value].children,(a,E)=>(L(),to(h,{key:E,price:a.commodityMoney,desc:a.commodityDescribe,title:a.commodityName,thumb:a.commodityImage},{footer:C(()=>[d(n,{icon:"minus",type:"primary",size:"mini",round:"",plain:"",onClick:H=>T("delect",a.num,E)},null,8,["onClick"]),c("span",null,S(a.num),1),d(n,{icon:"plus",type:"primary",size:"mini",round:"",onClick:H=>T("add",a.num,E)},null,8,["onClick"])]),_:2},1032,["price","desc","title","thumb"]))),128))]),_:1},8,["active-id","main-active-index","items"])]),d(G,{price:x.value,"button-text":"提交订单",onSubmit:V},null,8,["price"])]),d(W(ao))])}}},So=J(yo,[["__scopeId","data-v-fae89447"]]);export{So as default};
